name: Build Agents Action
description: Build country's agents into a docker image
inputs:
  fc-country:
    required: true
    description: Country's agents
  github-token:
    required: true
    description: GH credentials
runs:
  using: composite
  steps:
    - run: |
        cp ${{ github.action_path }}/Dockerfile . |
        cp ${{ github.action_path }}/.dockerignore .
      shell: bash
    - run: |
        export DOCKER_IMAGE=docker.pkg.github.com/$GITHUB_REPOSITORY/fc-agents-${{ inputs.fc-country }}
        echo "::set-env name=DOCKER_IMAGE::$DOCKER_IMAGE"
      shell: bash
    - run: docker build --build-arg FC_COUNTRY="${{ inputs.fc-country }}" --tag $DOCKER_IMAGE .
      shell: bash
    - run: echo ${{ inputs.github-token }} | docker login docker.pkg.github.com --username ${{ github.actor }} --password-stdin
      shell: bash
    - run: docker push $DOCKER_IMAGE
      shell: bash
